---
title: "Homerange Overlaps"
author: "Kyra Bankhead"
date: "2023-07-17"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this markdown I will:

1. Convert coordinate degree data into meters and organize this data into a spatial points data frame.

2. Plot the individualized homerange overlaps.

# PART 1: *Spatial Points Data Frame*

```{r data, message=FALSE, warning=FALSE, include=FALSE}
# Set working directory here
setwd("C:/Users/bankh/My_Repos/Dolphins/data")

## load all necessary packages
library(sf) # Convert degrees to meters
library(sp) # Creates a SpatialPointsDataFrame by defining the coordinates
library(adehabitatHR) # Caluculate MCPs
library(scales) # Helps make polygons partly transparent using the alpha argument

# Read in file
sample_data <- read.csv("sample_data.csv")

# Extract coordinates
coord_data <- cbind(sample_data[,c('Date', 'StartLat', 'StartLon', 'Code')]) # Subset Date and Coordinates #
## Format date and year
coord_data$Date <- as.Date(as.character(coord_data$Date), format="%Y-%m-%d")
coord_data$Year <- as.numeric(format(coord_data$Date, format = "%Y"))
## Give descriptive names
colnames(coord_data) <- c("date", "y", "x", "id", "year")

# Seperate map per years
years <- unique(coord_data$year)
coord_years <- list()
for (i in 1:length(years)) {
  coord_years[[i]] <- subset(coord_data, subset=c(coord_data$year == years[i]))
}    

# Test one year at a time
coord_data <- coord_years[[1]]

# Eliminate IDs with less than 5 locations
coord_data <- subset(coord_data, subset=c(coord_data$id != "None"))
ID <- unique(coord_data$id)
obs_vect <- NULL
for (i in 1:length(ID)) {
  obs_vect[i]<- sum(coord_data$id == ID[i])
}
sub <- data.frame(ID, obs_vect)
sub <- subset(sub, subset=c(sub$obs_vect > 4))
coord_data <- subset(coord_data, coord_data$id %in% c(sub$ID))

# Only include three columns (id, x, and y coordinates) for making MCP's
dolph.sp <- coord_data[, c("id", "y", "x")] 

```

## Convert coordinate degrees into meters

You can also embed plots, for example:

```{r meters, echo=TRUE, message=FALSE, warning=FALSE}
# Create a simple feature data frame (sf)
coord_data_sf <- st_as_sf(dolph.sp, coords = c("x", "y"), crs = 4326)

# UTM zone for study area
dolph.sf <- st_transform(coord_data_sf, crs = paste0("+proj=utm +zone=17 +datum=WGS84 +units=m +no_defs"))
# Extract coordinates (latitude and longitude) and create new columns
dolph.sp$x <- st_coordinates(dolph.sf)[, 1]
dolph.sp$y <- st_coordinates(dolph.sf)[, 2]
# Remove two rows with NA's
dolph.sp <- dolph.sp[!is.na(dolph.sp$x) & !is.na(dolph.sp$y),]

coordinates(dolph.sp) <- c("x", "y")

```

## Organize data into a spatial points data frame

```{r SP, echo=TRUE, message=FALSE, warning=FALSE}
# Set the initial CRS for data to WGS84 (latitude and longitude)
proj4string(dolph.sp) <- CRS( "+proj=utm +zone=17 +datum=WGS84 +units=m +no_defs" )

# Calculate MCPs for each dolphin
dolph.mcp <- mcp(dolph.sp, percent = 95)

```


# PART 2: *Homerange Overlaps*

## Plot the individual homerange overlaps

```{r hro, echo=TRUE, message=FALSE, warning=FALSE}
# Plot
plot(dolph.sp, col = as.factor(dolph.sp@data$id), pch = 16, asp = 1)
plot(dolph.mcp, col = alpha(1:5, 0.5), add = TRUE)

```

